services:
  # === App Proxy (Umbrel integration) ===
  app_proxy:
    image: getumbrel/app-proxy:1.0.0
    restart: on-failure
    environment:
      APP_HOST: frontend
      APP_PORT: '80'
      PROXY_AUTH_ADD: 'false'
    volumes:
      - ${APP_DATA_DIR:-.}/umbrel-app.yml:/extra/umbrel-app.yml:ro

  # === Backend API (Node.js + SQLite) ===
  backend:
    image: ghcr.io/bobparkerbob888-tech/happychina-pool-backend:2.1.0
    restart: on-failure
    environment:
      PORT: '8080'
      HOST: '0.0.0.0'
      JWT_SECRET: ${APP_SEED}
      POOL_NAME: 'HappyChina Pool'
      POOL_FEE: '1.0'
      DB_PATH: /app/data/pool.db
      BTC_RPC_HOST: bitcoind
      BTC_RPC_PORT: '8332'
      BTC_RPC_USER: umbrel
      BTC_RPC_PASS: umbrel
      LTC_RPC_HOST: litecoind
      LTC_RPC_PORT: '9332'
      LTC_RPC_USER: umbrel
      LTC_RPC_PASS: umbrel
      DOGE_RPC_HOST: dogecoind
      DOGE_RPC_PORT: '22555'
      DOGE_RPC_USER: umbrel
      DOGE_RPC_PASS: umbrel
      NMC_RPC_HOST: namecoind
      NMC_RPC_PORT: '8336'
      NMC_RPC_USER: umbrel
      NMC_RPC_PASS: umbrel
      PEPE_RPC_HOST: pepecoind
      PEPE_RPC_PORT: '29373'
      PEPE_RPC_USER: umbrel
      PEPE_RPC_PASS: umbrel
      BELLS_RPC_HOST: bellsd
      BELLS_RPC_PORT: '19918'
      BELLS_RPC_USER: umbrel
      BELLS_RPC_PASS: umbrel
      LKY_RPC_HOST: luckycoind
      LKY_RPC_PORT: '9918'
      LKY_RPC_USER: umbrel
      LKY_RPC_PASS: umbrel
      JKC_RPC_HOST: junkcoind
      JKC_RPC_PORT: '9772'
      JKC_RPC_USER: umbrel
      JKC_RPC_PASS: umbrel
      DINGO_RPC_HOST: dingocoind
      DINGO_RPC_PORT: '34646'
      DINGO_RPC_USER: umbrel
      DINGO_RPC_PASS: umbrel
      SHIC_RPC_HOST: shibacoind
      SHIC_RPC_PORT: '33863'
      SHIC_RPC_USER: umbrel
      SHIC_RPC_PASS: umbrel
      TRMP_RPC_HOST: trumpowd
      TRMP_RPC_PORT: '33883'
      TRMP_RPC_USER: umbrel
      TRMP_RPC_PASS: umbrel
    volumes:
      - pool-data:/app/data
      - ${APP_DATA_DIR:-.}/frontend/build:/frontend/build:ro
    ports:
      - '8080:8080'
      - '3332-3344:3332-3344'
    expose:
      - '8080'

  # === Init: fix data directory permissions ===
  init:
    image: alpine:3.19
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        chmod -R 777 /data/bitcoin /data/namecoin 2>/dev/null || true
        echo "Permissions fixed."
    volumes:
      - ${APP_DATA_DIR:-.}/data/bitcoin:/data/bitcoin
      - ${APP_DATA_DIR:-.}/data/namecoin:/data/namecoin

  # === Frontend (React + Nginx) ===
  frontend:
    image: ghcr.io/bobparkerbob888-tech/happychina-pool-frontend:2.1.0
    restart: on-failure
    depends_on:
      - backend
    expose:
      - '80'

  # === Coin Daemons ===
  bitcoind:
    image: lncm/bitcoind:v28.0
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/bitcoin:/data/.bitcoin
    command:
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=8332'
      - '-port=8333'
      - '-txindex=1'
      - '-printtoconsole'
      - '-dbcache=8192'
      - '-par=0'
      - '-maxmempool=300'
      - '-rpcworkqueue=128'
      - '-rpcthreads=8'
    ports:
      - '8332:8332'
      - '8333:8333'

  namecoind:
    image: sevenrats/namecoin-core:latest
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/namecoin:/home/namecoin/.namecoin
    command:
      - namecoind
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=8336'
      - '-port=8334'
      - '-txindex=1'
      - '-printtoconsole'
      - '-dbcache=512'
    ports:
      - '8336:8336'

  litecoind:
    image: uphold/litecoin-core:0.21
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/litecoin:/home/litecoin/.litecoin
    command:
      - litecoind
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=9332'
      - '-port=9333'
      - '-txindex=1'
      - '-printtoconsole'
      - '-dbcache=512'
      - '-par=0'
    ports:
      - '9332:9332'
      - '9333:9333'

  dogecoind:
    image: btcpayserver/dogecoin:1.14.9-amd64
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/dogecoin:/root/.dogecoin
    command:
      - dogecoind
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=22555'
      - '-port=22556'
      - '-txindex=1'
      - '-printtoconsole'
      - '-dbcache=4096'
      - '-par=0'
      - '-addnode=65.108.79.95:22556'
      - '-addnode=188.40.103.122:22556'
      - '-addnode=23.88.18.235:22556'
      - '-addnode=5.9.68.211:22556'
      - '-addnode=157.173.198.7:22556'
    ports:
      - '22555:22555'

  pepecoind:
    image: pepeenthusiast/pepecoin-core:latest
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/pepecoin:/home/pepecoin/.pepecoin
    command:
      - pepecoind
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=29373'
      - '-port=29374'
      - '-printtoconsole'
      - '-dbcache=512'
      - '-par=0'
    ports:
      - '29373:29373'

  bellsd:
    image: ghcr.io/bobparkerbob888-tech/bellscoin:3.0
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/bells:/root/.bells
    command:
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=19918'
      - '-port=19919'
      - '-printtoconsole'
      - '-dbcache=512'
      - '-par=0'
    ports:
      - '19918:19918'
      - '19919:19919'

  luckycoind:
    image: btccom/luckycoin:4.0.1
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/luckycoin:/root/.luckycoin
    command:
      - /bin/luckycoind
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=9918'
      - '-port=9917'
      - '-printtoconsole'
      - '-maxtipage=63072000'
      - '-dbcache=3072'
      - '-par=0'
    ports:
      - '9918:9918'
      - '9917:9917'

  junkcoind:
    image: btccom/junkcoin:latest
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/junkcoin:/root/.junkcoin
    command:
      - /usr/local/bin/junkcoind
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=9772'
      - '-port=9771'
      - '-printtoconsole'
      - '-dbcache=512'
      - '-par=0'
    ports:
      - '9772:9772'
      - '9771:9771'

  dingocoind:
    image: ghcr.io/bobparkerbob888-tech/dingocoin:v1.18.0.0
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/dingocoin:/root/.dingocoin
    command:
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=34646'
      - '-port=33117'
      - '-printtoconsole'
      - '-dbcache=512'
      - '-par=0'
    ports:
      - '34646:34646'
      - '33117:33117'

  shibacoind:
    image: ghcr.io/bobparkerbob888-tech/shibacoin:1.2.1
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/shibacoin:/root/.shibacoin
    command:
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=33863'
      - '-port=33864'
      - '-printtoconsole'
      - '-dbcache=512'
      - '-par=0'
    ports:
      - '33863:33863'
      - '33864:33864'

  trumpowd:
    image: ghcr.io/bobparkerbob888-tech/trumpow:1.0
    restart: unless-stopped
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR:-.}/data/trumpow:/root/.trumpow
    command:
      - '-server=1'
      - '-rpcuser=umbrel'
      - '-rpcpassword=umbrel'
      - '-rpcallowip=0.0.0.0/0'
      - '-rpcbind=0.0.0.0'
      - '-rpcport=33883'
      - '-port=33884'
      - '-printtoconsole'
      - '-dbcache=512'
      - '-par=0'
    ports:
      - '33883:33883'
      - '33884:33884'

volumes:
  pool-data:
